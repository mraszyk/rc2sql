<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Mapping_Code</title>
</head>


<body>
<div class="head">
<h1>Theory Mapping_Code</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Mapping_Code
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../AFP/Containers/Mapping_Impl.html">Containers.Mapping_Impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> set_of_idx <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span> set<span class="main">)</span> mapping <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span>ran <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_of_idx_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ccompare<span class="main">,</span> <span class="tfree">'b</span> set<span class="main">)</span> mapping_rbt"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_of_idx <span class="main">(</span>RBT_Mapping <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> ID <span class="keyword1">CCOMPARE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''set_of_idx RBT_Mapping: ccompare = None''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> set_of_idx <span class="main">(</span>RBT_Mapping <span class="free">t</span><span class="main">)</span><span class="main">)</span>
    <span class="main">|</span> Some <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">⋃</span><span class="main">(</span>snd <span class="main">`</span> set <span class="main">(</span>RBT_Mapping2.entries <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> RBT_Mapping_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ran_def rbt_comp_lookup<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ID_ccompare'<span class="main"><span class="main">]</span></span> ord.is_rbt_def linorder.rbt_lookup_in_tree<span class="main"><span class="main">[</span></span><span class="operator">OF</span> comparator.linorder<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> ID_ccompare'<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mapping_combine<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ccompare<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping_rbt"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Mapping.combine <span class="free">f</span> <span class="main">(</span>RBT_Mapping <span class="free">t</span><span class="main">)</span> <span class="main">(</span>RBT_Mapping <span class="free">u</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> ID <span class="keyword1">CCOMPARE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''combine RBT_Mapping: ccompare = None''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> Mapping.combine <span class="free">f</span> <span class="main">(</span>RBT_Mapping <span class="free">t</span><span class="main">)</span> <span class="main">(</span>RBT_Mapping <span class="free">u</span><span class="main">)</span><span class="main">)</span>
    <span class="main">|</span> Some <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> RBT_Mapping <span class="main">(</span>RBT_Mapping2.join <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">f</span><span class="main">)</span> <span class="free">t</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Mapping.combine.abs_eq Mapping_inject lookup_join <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> mapping_join <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">m</span> <span class="bound">m'</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">m</span> <span class="bound">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">y</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">m'</span> <span class="bound">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">y'</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="bound">f</span> <span class="bound">y</span> <span class="bound">y'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mapping_join_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ccompare<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping_rbt"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mapping_join <span class="free">f</span> <span class="main">(</span>RBT_Mapping <span class="free">t</span><span class="main">)</span> <span class="main">(</span>RBT_Mapping <span class="free">u</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> ID <span class="keyword1">CCOMPARE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''mapping_join RBT_Mapping: ccompare = None''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> mapping_join <span class="free">f</span> <span class="main">(</span>RBT_Mapping <span class="free">t</span><span class="main">)</span> <span class="main">(</span>RBT_Mapping <span class="free">u</span><span class="main">)</span><span class="main">)</span>
    <span class="main">|</span> Some <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> RBT_Mapping <span class="main">(</span>RBT_Mapping2.meet <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">f</span><span class="main">)</span> <span class="free">t</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapping_join.abs_eq Mapping_inject lookup_meet <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">dummy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ccompare"</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> diff <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping_rbt <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping_rbt <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping_rbt"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"rbt_comp_minus ccomp"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 4 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> linorder.rbt_minus_is_rbt ID_ccompare ord.is_rbt_rbt_sorted <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rbt_comp_minus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ID_ccompare'<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> ID_ccompare_neq_None<span class="main">:</span> <span class="quoted"><span class="quoted">"ID <span class="keyword1">CCOMPARE</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ccompare<span class="main">)</span> <span class="main">≠</span> None"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lookup_diff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"RBT_Mapping2.lookup <span class="main">(</span>diff <span class="main">(</span><span class="free">t1</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping_rbt<span class="main">)</span> <span class="free">t2</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="keyword1">case</span> RBT_Mapping2.lookup <span class="free">t1</span> <span class="bound">k</span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">v1</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> RBT_Mapping2.lookup <span class="free">t2</span> <span class="bound">k</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Some <span class="bound">v1</span> <span class="main">|</span> Some <span class="bound">v2</span> <span class="main">⇒</span> None<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff linorder.rbt_lookup_rbt_minus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mapping_linorder<span class="main"><span class="main">]</span></span> ID_ccompare_neq_None restrict_map_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> mapping_antijoin <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">m</span> <span class="bound">m'</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">m</span> <span class="bound">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">y</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">m'</span> <span class="bound">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Some <span class="bound">y</span> <span class="main">|</span> Some <span class="bound">y'</span> <span class="main">⇒</span> None<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mapping_antijoin_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> ccompare<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> mapping_rbt"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mapping_antijoin <span class="main">(</span>RBT_Mapping <span class="free">t</span><span class="main">)</span> <span class="main">(</span>RBT_Mapping <span class="free">u</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> ID <span class="keyword1">CCOMPARE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">of</span> None <span class="main">⇒</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''mapping_antijoin RBT_Mapping: ccompare = None''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> mapping_antijoin <span class="main">(</span>RBT_Mapping <span class="free">t</span><span class="main">)</span> <span class="main">(</span>RBT_Mapping <span class="free">u</span><span class="main">)</span><span class="main">)</span>
    <span class="main">|</span> Some <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> RBT_Mapping <span class="main">(</span>diff <span class="free">t</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapping_antijoin.abs_eq Mapping_inject lookup_diff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>