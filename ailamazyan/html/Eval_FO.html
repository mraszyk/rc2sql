<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Eval_FO</title>
</head>


<body>
<div class="head">
<h1>Theory Eval_FO</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Eval_FO
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Infinite.html">Infinite</a> <a href="FO.html">FO</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> eval_res <span class="main">=</span> Fin <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> table"</span></span> <span class="main">|</span> Infin <span class="main">|</span> Wf_error

<span class="keyword1"><span class="command">locale</span></span> eval_fo <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> infinite<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">abs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> fo_term<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> table <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">rep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'a</span> table"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">res</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'a</span> eval_res"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval_bool</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fo_term <span class="main">⇒</span> <span class="tfree">'a</span> fo_term <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval_neg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval_conj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> nat list <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval_ajoin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> nat list <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval_disj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> nat list <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval_exists</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval_forall</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fo_rep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="free">φ</span> <span class="free">I</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">rep</span> <span class="free">t</span> <span class="main">=</span> proj_sat <span class="free">φ</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fo_res_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="free">φ</span> <span class="free">I</span> <span class="free">t</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">rep</span> <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">res</span> <span class="free">t</span> <span class="main">=</span> Fin <span class="main">(</span><span class="free">rep</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fo_res_infin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="free">φ</span> <span class="free">I</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">¬</span>finite <span class="main">(</span><span class="free">rep</span> <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">res</span> <span class="free">t</span> <span class="main">=</span> Infin"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fo_abs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">I</span> <span class="main">(</span><span class="free">r</span><span class="main">,</span> length <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">wf</span> <span class="main">(</span>Pred <span class="free">r</span> <span class="free">ts</span><span class="main">)</span> <span class="free">I</span> <span class="main">(</span><span class="free">abs</span> <span class="free">ts</span> <span class="main">(</span><span class="free">I</span> <span class="main">(</span><span class="free">r</span><span class="main">,</span> length <span class="free">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fo_bool<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="main">(</span>Bool <span class="free">b</span><span class="main">)</span> <span class="free">I</span> <span class="main">(</span><span class="free">eval_bool</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fo_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="main">(</span>Eqa <span class="free">trm</span> <span class="free">trm'</span><span class="main">)</span> <span class="free">I</span> <span class="main">(</span><span class="free">eval_eq</span> <span class="free">trm</span> <span class="free">trm'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fo_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="free">φ</span> <span class="free">I</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">wf</span> <span class="main">(</span>Neg <span class="free">φ</span><span class="main">)</span> <span class="free">I</span> <span class="main">(</span><span class="free">eval_neg</span> <span class="main">(</span>fv_fo_fmla_list <span class="free">φ</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fo_conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="free">φ</span> <span class="free">I</span> <span class="free">tφ</span> <span class="main">⟹</span> <span class="free">wf</span> <span class="free">ψ</span> <span class="free">I</span> <span class="free">tψ</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">ψ</span> <span class="keyword1">of</span> Neg <span class="bound">ψ'</span> <span class="main">⇒</span> False <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> True<span class="main">)</span> <span class="main">⟹</span>
    <span class="free">wf</span> <span class="main">(</span>Conj <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="free">I</span> <span class="main">(</span><span class="free">eval_conj</span> <span class="main">(</span>fv_fo_fmla_list <span class="free">φ</span><span class="main">)</span> <span class="free">tφ</span> <span class="main">(</span>fv_fo_fmla_list <span class="free">ψ</span><span class="main">)</span> <span class="free">tψ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fo_ajoin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="free">φ</span> <span class="free">I</span> <span class="free">tφ</span> <span class="main">⟹</span> <span class="free">wf</span> <span class="free">ψ'</span> <span class="free">I</span> <span class="free">tψ'</span> <span class="main">⟹</span>
    <span class="free">wf</span> <span class="main">(</span>Conj <span class="free">φ</span> <span class="main">(</span>Neg <span class="free">ψ'</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="main">(</span><span class="free">eval_ajoin</span> <span class="main">(</span>fv_fo_fmla_list <span class="free">φ</span><span class="main">)</span> <span class="free">tφ</span> <span class="main">(</span>fv_fo_fmla_list <span class="free">ψ'</span><span class="main">)</span> <span class="free">tψ'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fo_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="free">φ</span> <span class="free">I</span> <span class="free">tφ</span> <span class="main">⟹</span> <span class="free">wf</span> <span class="free">ψ</span> <span class="free">I</span> <span class="free">tψ</span> <span class="main">⟹</span>
    <span class="free">wf</span> <span class="main">(</span>Disj <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="free">I</span> <span class="main">(</span><span class="free">eval_disj</span> <span class="main">(</span>fv_fo_fmla_list <span class="free">φ</span><span class="main">)</span> <span class="free">tφ</span> <span class="main">(</span>fv_fo_fmla_list <span class="free">ψ</span><span class="main">)</span> <span class="free">tψ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fo_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="free">φ</span> <span class="free">I</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">wf</span> <span class="main">(</span>Exists <span class="free">i</span> <span class="free">φ</span><span class="main">)</span> <span class="free">I</span> <span class="main">(</span><span class="free">eval_exists</span> <span class="free">i</span> <span class="main">(</span>fv_fo_fmla_list <span class="free">φ</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fo_forall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="free">φ</span> <span class="free">I</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">wf</span> <span class="main">(</span>Forall <span class="free">i</span> <span class="free">φ</span><span class="main">)</span> <span class="free">I</span> <span class="main">(</span><span class="free">eval_forall</span> <span class="free">i</span> <span class="main">(</span>fv_fo_fmla_list <span class="free">φ</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval_fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> table<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_intp <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_fmla</span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="free">abs</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> length <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_fmla</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="free">eval_bool</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_fmla</span> <span class="main">(</span>Eqa <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="free">eval_eq</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_fmla</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="free">eval_neg</span> <span class="main">(</span>fv_fo_fmla_list <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">eval_fmla</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_fmla</span> <span class="main">(</span>Conj <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">nsφ</span> <span class="main">=</span> fv_fo_fmla_list <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">;</span> <span class="bound">nsψ</span> <span class="main">=</span> fv_fo_fmla_list <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">;</span>
    <span class="bound">Xφ</span> <span class="main">=</span> <span class="free">eval_fmla</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1">in</span>
  <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="keyword1">of</span> Neg <span class="bound">ψ'</span> <span class="main">⇒</span> <span class="keyword1">let</span> <span class="bound">Xψ'</span> <span class="main">=</span> <span class="free">eval_fmla</span> <span class="bound">ψ'</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1">in</span>
    <span class="free">eval_ajoin</span> <span class="bound">nsφ</span> <span class="bound">Xφ</span> <span class="main">(</span>fv_fo_fmla_list <span class="bound">ψ'</span><span class="main">)</span> <span class="bound">Xψ'</span>
  <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="free">eval_conj</span> <span class="bound">nsφ</span> <span class="bound">Xφ</span> <span class="bound">nsψ</span> <span class="main">(</span><span class="free">eval_fmla</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_fmla</span> <span class="main">(</span>Disj <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="free">eval_disj</span> <span class="main">(</span>fv_fo_fmla_list <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">eval_fmla</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>
    <span class="main">(</span>fv_fo_fmla_list <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">eval_fmla</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_fmla</span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="free">eval_exists</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>fv_fo_fmla_list <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">eval_fmla</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_fmla</span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="free">eval_forall</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>fv_fo_fmla_list <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">eval_fmla</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fmla_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> infinite<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_fo_intp <span class="free">φ</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="free">φ</span> <span class="free">I</span> <span class="main">(</span>eval_fmla <span class="free">φ</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eval_fmla.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">r</span> <span class="skolem">ts</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fo_abs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">b</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fo_bool
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t</span> <span class="skolem">t'</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fo_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">φ</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fo_neg
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">φ</span> <span class="skolem">ψ</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fins<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_fo_intp <span class="skolem">φ</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"wf_fo_intp <span class="skolem">ψ</span> <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>10<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> evalφ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="skolem">φ</span> <span class="skolem">I</span> <span class="main">(</span>eval_fmla <span class="skolem">φ</span> <span class="skolem">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ _ fins<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ψ'</span><span class="main">.</span> <span class="skolem">ψ</span> <span class="main">=</span> Neg <span class="bound">ψ'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ψ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ψ_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ψ</span> <span class="main">=</span> Neg <span class="skolem">ψ'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_fo_intp <span class="skolem">ψ'</span> <span class="skolem">I</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fins<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ψ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> evalψ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="skolem">ψ'</span> <span class="skolem">I</span> <span class="main">(</span>eval_fmla <span class="skolem">ψ'</span> <span class="skolem">I</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ _ _ ψ_def fin<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ψ_def
      <span class="keyword1"><span class="command">using</span></span> fo_ajoin<span class="main">[</span><span class="operator">OF</span> evalφ evalψ'<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> evalψ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="skolem">ψ</span> <span class="skolem">I</span> <span class="main">(</span>eval_fmla <span class="skolem">ψ</span> <span class="skolem">I</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 5 fins<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ψ</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> eval<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_fmla <span class="main">(</span>Conj <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">I</span> <span class="main">=</span> <span class="free">eval_conj</span> <span class="main">(</span>fv_fo_fmla_list <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span>eval_fmla <span class="skolem">φ</span> <span class="skolem">I</span><span class="main">)</span>
      <span class="main">(</span>fv_fo_fmla_list <span class="skolem">ψ</span><span class="main">)</span> <span class="main">(</span>eval_fmla <span class="skolem">ψ</span> <span class="skolem">I</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> fo_fmla.splits<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="main">(</span>Conj <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">I</span> <span class="main">(</span>eval_fmla <span class="main">(</span>Conj <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span> <span class="skolem">I</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fo_conj<span class="main">[</span><span class="operator">OF</span> evalφ evalψ<span class="main">,</span> <span class="operator">folded</span> eval<span class="main">]</span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> fo_fmla.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">φ</span> <span class="skolem">ψ</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fo_disj
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">i</span> <span class="skolem">φ</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fo_exists
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">i</span> <span class="skolem">φ</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fo_forall
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> table<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_intp <span class="main">⇒</span> <span class="tfree">'a</span> eval_res"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> wf_fo_intp <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1">then</span> <span class="free">res</span> <span class="main">(</span>eval_fmla <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span> <span class="keyword1">else</span> Wf_error<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_fmla_proj_sat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> infinite<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_fo_intp <span class="free">φ</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rep</span> <span class="main">(</span>eval_fmla <span class="free">φ</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> proj_sat <span class="free">φ</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eval_fmla_correct<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fo_rep<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> infinite<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">φ</span> <span class="free">I</span> <span class="main">=</span> Fin <span class="free">Z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Z</span> <span class="main">=</span> proj_sat <span class="free">φ</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="free">φ</span> <span class="free">I</span> <span class="main">(</span>eval_fmla <span class="free">φ</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_fmla_correct assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms fo_res_fin fo_res_infin
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_def fo_rep <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> infinite<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eval <span class="free">φ</span> <span class="free">I</span> <span class="main">=</span> Infin"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>proj_sat <span class="free">φ</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="free">φ</span> <span class="free">I</span> <span class="main">(</span>eval_fmla <span class="free">φ</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval_fmla_correct assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms fo_res_fin
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_def fo_rep <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</body>

</html>