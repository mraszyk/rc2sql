<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory FO</title>
</head>


<body>
<div class="head">
<h1>Theory FO</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">theory</span></span> FO
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">sorted_distinct</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> sorted <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∧</span> distinct <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> fo_term <span class="main">=</span> Const <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">|</span> Var <span class="quoted">nat</span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> val <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">list_fo_term</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fo_term <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_fo_term</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">list_fo_term</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fv_fo_term_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fo_term <span class="main">⇒</span> nat list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fv_fo_term_list</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_term_list</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fv_fo_term_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fo_term <span class="main">⇒</span> nat set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fv_fo_term_set</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_term_set</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fv_fo_terms_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> fo_term<span class="main">)</span> list <span class="main">⇒</span> nat set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fv_fo_terms_set</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span>set <span class="main">(</span>map fv_fo_term_set <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fv_fo_terms_list_rec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> fo_term<span class="main">)</span> list <span class="main">⇒</span> nat list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fv_fo_terms_list_rec</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_terms_list_rec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> fv_fo_term_list <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">@</span> <span class="free">fv_fo_terms_list_rec</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fv_fo_terms_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> fo_term<span class="main">)</span> list <span class="main">⇒</span> nat list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fv_fo_terms_list</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> remdups_adj <span class="main">(</span>sort <span class="main">(</span>fv_fo_terms_list_rec <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval_term</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> val <span class="main">⇒</span> <span class="tfree">'a</span> fo_term <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_term</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_term</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eval_terms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> val <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> fo_term<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊙</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_terms</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">=</span> map <span class="main">(</span>eval_term <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_set_fo_term<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set_fo_term <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> list_fo_term_set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>list_fo_term <span class="free">t</span><span class="main">)</span> <span class="main">=</span> set_fo_term <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_fv_fo_term_set<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fv_fo_term_set <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fv_fo_term_setD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> fv_fo_term_set <span class="free">t</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">=</span> Var <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fv_fo_term_set_list<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>fv_fo_term_list <span class="free">t</span><span class="main">)</span> <span class="main">=</span> fv_fo_term_set <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_distinct_fv_fo_term_list<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_distinct <span class="main">(</span>fv_fo_term_list <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fv_fo_term_set_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"fv_fo_term_set <span class="free">t</span> <span class="main">=</span> fv_fo_term_set <span class="main">(</span>map_fo_term <span class="free">f</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fv_fo_terms_setI<span class="main">:</span> <span class="quoted"><span class="quoted">"Var <span class="free">m</span> <span class="main">∈</span> set <span class="free">ts</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">∈</span> fv_fo_terms_set <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fv_fo_terms_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fv_fo_terms_setD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> fv_fo_terms_set <span class="free">ts</span> <span class="main">⟹</span> Var <span class="free">m</span> <span class="main">∈</span> set <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fv_fo_terms_set_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> fv_fo_term_setD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_fv_fo_terms_set<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fv_fo_terms_set <span class="free">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fv_fo_terms_set_def finite_fv_fo_term_set<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fv_fo_terms_set_list<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>fv_fo_terms_list <span class="free">ts</span><span class="main">)</span> <span class="main">=</span> fv_fo_terms_set <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fv_fo_term_set_list
  <span class="keyword1"><span class="command">unfolding</span></span> fv_fo_terms_list_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fv_fo_terms_list_rec.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fv_fo_terms_set_def set_insort_key<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_remdups_adj_sort<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span> <span class="main">⟹</span> distinct <span class="main">(</span>remdups_adj <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> induct_list012<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_distinct_fv_fo_terms_list<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_distinct <span class="main">(</span>fv_fo_terms_list <span class="free">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fv_fo_terms_list_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ts</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fv_fo_terms_list_rec.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_insort <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> distinct_remdups_adj_sort<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fv_fo_terms_set_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"fv_fo_terms_set <span class="free">ts</span> <span class="main">=</span> fv_fo_terms_set <span class="main">(</span>map <span class="main">(</span>map_fo_term <span class="free">f</span><span class="main">)</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fv_fo_term_set_cong
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fv_fo_terms_set_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_term_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> fv_fo_term_set <span class="free">t</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">σ'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span>
  eval_term <span class="free">σ</span> <span class="free">t</span> <span class="main">=</span> eval_term <span class="free">σ'</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_terms_fv_fo_terms_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">⊙</span> <span class="free">ts</span> <span class="main">=</span> <span class="free">σ'</span> <span class="main">⊙</span> <span class="free">ts</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> fv_fo_terms_set <span class="free">ts</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="free">n</span> <span class="main">=</span> <span class="free">σ'</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ts</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">t</span> <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_terms_def fv_fo_terms_set_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_terms_def fv_fo_terms_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_terms_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> fv_fo_terms_set <span class="free">ts</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">σ'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span>
  eval_terms <span class="free">σ</span> <span class="free">ts</span> <span class="main">=</span> eval_terms <span class="free">σ'</span> <span class="free">ts</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_terms_def fv_fo_terms_set_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eval_term_cong<span class="main">)</span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla <span class="main">=</span>
  Pred <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> fo_term<span class="main">)</span> list"</span></span>
<span class="main">|</span> Bool <span class="quoted">bool</span>
<span class="main">|</span> Eqa <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fo_term"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fo_term"</span></span>
<span class="main">|</span> Neg <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla"</span></span>
<span class="main">|</span> Conj <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla"</span></span>
<span class="main">|</span> Disj <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla"</span></span>
<span class="main">|</span> Exists <span class="quoted">nat</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla"</span></span>
<span class="main">|</span> Forall <span class="quoted">nat</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fv_fo_fmla_list_rec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla <span class="main">⇒</span> nat list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla_list_rec</span> <span class="main">(</span>Pred <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> fv_fo_terms_list <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla_list_rec</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla_list_rec</span> <span class="main">(</span>Eqa <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">=</span> fv_fo_term_list <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">@</span> fv_fo_term_list <span class="free"><span class="bound"><span class="entity">t'</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla_list_rec</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fv_fo_fmla_list_rec</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla_list_rec</span> <span class="main">(</span>Conj <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fv_fo_fmla_list_rec</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">@</span> <span class="free">fv_fo_fmla_list_rec</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla_list_rec</span> <span class="main">(</span>Disj <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fv_fo_fmla_list_rec</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">@</span> <span class="free">fv_fo_fmla_list_rec</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla_list_rec</span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≠</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span><span class="free">fv_fo_fmla_list_rec</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla_list_rec</span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≠</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span><span class="free">fv_fo_fmla_list_rec</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fv_fo_fmla_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla <span class="main">⇒</span> nat list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla_list</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> remdups_adj <span class="main">(</span>sort <span class="main">(</span>fv_fo_fmla_list_rec <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fv_fo_fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla <span class="main">⇒</span> nat set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla</span> <span class="main">(</span>Pred <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="main">=</span> fv_fo_terms_set <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla</span> <span class="main">(</span>Eqa <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="main">=</span> fv_fo_term_set <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∪</span> fv_fo_term_set <span class="free"><span class="bound"><span class="entity">t'</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fv_fo_fmla</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla</span> <span class="main">(</span>Conj <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fv_fo_fmla</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">fv_fo_fmla</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla</span> <span class="main">(</span>Disj <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fv_fo_fmla</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">∪</span> <span class="free">fv_fo_fmla</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla</span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fv_fo_fmla</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fv_fo_fmla</span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">fv_fo_fmla</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_fv_fo_fmla<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fv_fo_fmla <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fv_fo_fmla.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_fv_fo_term_set finite_fv_fo_terms_set<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fv_fo_fmla_list_set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>fv_fo_fmla_list <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> fv_fo_fmla <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fv_fo_fmla_list_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fv_fo_fmla.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fv_fo_terms_set_list fv_fo_term_set_list<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sorted_distinct_fv_list<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_distinct <span class="main">(</span>fv_fo_fmla_list <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fv_fo_fmla_list_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> distinct_remdups_adj_sort<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_fv_fo_fmla_list<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>fv_fo_fmla_list <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>fv_fo_fmla <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fv_fo_fmla_list_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">φ</span></span><span class="main">]</span> sorted_distinct_fv_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">φ</span></span><span class="main">]</span>
    distinct_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fv_fo_fmla_list <span class="free">φ</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fv_fo_fmla_list_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"fv_fo_fmla <span class="free">φ</span> <span class="main">=</span> fv_fo_fmla <span class="free">ψ</span> <span class="main">⟹</span> fv_fo_fmla_list <span class="free">φ</span> <span class="main">=</span> fv_fo_fmla_list <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fv_fo_fmla_list_set sorted_distinct_fv_list
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sorted_distinct_set_unique<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fv_fo_fmla_list_Conj<span class="main">:</span> <span class="quoted"><span class="quoted">"fv_fo_fmla_list <span class="main">(</span>Conj <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">=</span> fv_fo_fmla_list <span class="main">(</span>Conj <span class="free">ψ</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fv_fo_fmla_list_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Conj <span class="free">φ</span> <span class="free">ψ</span>"</span></span> <span class="quoted"><span class="quoted">"Conj <span class="free">ψ</span> <span class="free">φ</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> table <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'t</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_intp <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">×</span> nat <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wf_fo_intp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> table<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_intp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_fo_intp</span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⟷</span> finite <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> length <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_fo_intp</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_fo_intp</span> <span class="main">(</span>Eqa <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_fo_intp</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⟷</span> <span class="free">wf_fo_intp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_fo_intp</span> <span class="main">(</span>Conj <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⟷</span> <span class="free">wf_fo_intp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> <span class="free">wf_fo_intp</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_fo_intp</span> <span class="main">(</span>Disj <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⟷</span> <span class="free">wf_fo_intp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> <span class="free">wf_fo_intp</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_fo_intp</span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⟷</span> <span class="free">wf_fo_intp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wf_fo_intp</span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⟷</span> <span class="free">wf_fo_intp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> table<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_intp <span class="main">⇒</span> <span class="tfree">'a</span> val <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="main">(</span>Pred <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⊙</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> length <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="main">(</span>Eqa <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟷</span> <span class="main">¬</span><span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="main">(</span>Conj <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟷</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">∧</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="main">(</span>Disj <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟷</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">∨</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="main">(</span>Exists <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">:=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sat</span> <span class="main">(</span>Forall <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">sat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">:=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sat_fv_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> fv_fo_fmla <span class="free">φ</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">σ'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span>
  sat <span class="free">φ</span> <span class="free">I</span> <span class="free">σ</span> <span class="main">⟷</span> sat <span class="free">φ</span> <span class="free">I</span> <span class="free">σ'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="free">σ'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Neg<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">σ</span></span> <span class="quoted"><span class="skolem">σ'</span></span><span class="main">]</span> Neg<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conj <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Conj<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">σ</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">σ'</span></span></span></span><span class="main">]</span> Conj<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Disj <span class="skolem">φ</span> <span class="skolem">ψ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Disj<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">σ</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">σ'</span></span></span></span><span class="main">]</span> Disj<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Exists <span class="skolem">n</span> <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> sat <span class="skolem">φ</span> <span class="free">I</span> <span class="main">(</span><span class="skolem">σ</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sat <span class="skolem">φ</span> <span class="free">I</span> <span class="main">(</span><span class="skolem">σ'</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Exists<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Exists<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Forall <span class="skolem">n</span> <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> sat <span class="skolem">φ</span> <span class="free">I</span> <span class="main">(</span><span class="skolem">σ</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sat <span class="skolem">φ</span> <span class="free">I</span> <span class="main">(</span><span class="skolem">σ'</span><span class="main">(</span><span class="skolem">n</span> <span class="main">:=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Forall<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Forall<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> eval_terms_cong eval_term_cong<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj_sat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_fmla <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> table<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> fo_intp <span class="main">⇒</span> <span class="tfree">'a</span> table"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proj_sat</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> map <span class="bound">σ</span> <span class="main">(</span>fv_fo_fmla_list <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> sat <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">σ</span><span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>